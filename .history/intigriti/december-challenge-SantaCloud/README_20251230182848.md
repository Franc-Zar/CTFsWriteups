# Intigriti's SantaCloud CTF challenge by [INTIGRITI](https://x.com/intigriti)

## Description

The solution:

* Should leverage a vulnerability on the challenge page.
* Shouldn't be self-XSS or related to MiTM attacks.
* Should require no user interaction.
* Should require no bruteforcing (if you have to, keep requests below 1 req/sec).
* Should include:
    * The flag in the format INTIGRITI{.*}
    * The payload(s) used
    * Steps to solve (short description / bullet points)
* Should be reported on the Intigriti platform.

Get started:

Repeat your attack against the [challenge server](https://santacloud.intigriti.io/home).

## TL;DR


## Analysis

The target is a **black-box web application** implementing a supply-chain portal for coordinating Christmas gifts, a system of... debatable usefulness. 
I mean, who would actually need something like this? Right?

![](https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExbDZhdzU1NTR4dDkxZXdoNDNsOGE3M2pwbDljMnE5djhzc3czOXh3NiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l2SqbZ1ggNuRHZkeA/giphy.gif)

At this point, we can only trust that the devel(f)opers implemented this correctly. Otherwise, Christmas might not survive the deployment.

![login](./imgs/login.png)

With no option for user registration and authentication restricted to existing accounts, the attack surface initially lies outside the login flow. 
Broad reconnaissance and endpoint enumeration are necessary to uncover exposed APIs, leaked data, and misconfigurations that could be chained into an authentication bypass.

The presence of the `laravel_session` cookie confirms the use of the Laravel framework, providing useful context for further enumeration.

The relevant endpoints were identified through **file/directory enumeration** performed with [gobuster](https://github.com/OJ/gobuster). 
These are listed below:

```bash
/                     (Status: 200) [Size: 3924]
/cgi-bin/             (Status: 301) [Size: 335] [--> http://santacloud.intigriti.io/cgi-bin]
/css                  (Status: 301) [Size: 332] [--> http://santacloud.intigriti.io/css/]
/home                 (Status: 200) [Size: 8094]
/images               (Status: 301) [Size: 335] [--> http://santacloud.intigriti.io/images/]
/inventory            (Status: 200) [Size: 11499]
/login                (Status: 200) [Size: 5883]
/map                  (Status: 200) [Size: 12945]
/notes                (Status: 200) [Size: 15135]
/profile              (Status: 200) [Size: 7523]
/up                   (Status: 200) [Size: 1954]
```

Moreover, inspection of the login page source code reveals that backend endpoints are exposed under the `/api/` path.

```js
const response = await fetch('/api/login', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
    },
    body: JSON.stringify({ username, password })
});
```

All exposed backend endpoints can be obtained again through directory enumeration.

```bash
/                     (Status: 301) [Size: 331] [--> http://santacloud.intigriti.io/api]
/cgi-bin/             (Status: 301) [Size: 339] [--> http://santacloud.intigriti.io/api/cgi-bin]
/gifts                (Status: 401) [Size: 30]
/health               (Status: 200) [Size: 52]
/login                (Status: 405) [Size: 1011]
/logout               (Status: 405) [Size: 1011]
/me                   (Status: 401) [Size: 30]
/notes                (Status: 401) [Size: 30]
/users                (Status: 401) [Size: 30]
```

Running Nmap against the web application host reveals several disallowed entries quietly left under the Christmas tree üéÅüéÑ.

```bash
PORT    STATE SERVICE  VERSION
80/tcp  open  http     nginx (reverse proxy)
|_http-title: 308 Permanent Redirect
443/tcp open  ssl/http nginx (reverse proxy)
| ssl-cert: Subject: commonName=santacloud.intigriti.io
| Subject Alternative Name: DNS:santacloud.intigriti.io
| Not valid before: 2025-12-17T11:25:45
|_Not valid after:  2026-03-17T11:25:44
|_ssl-date: TLS randomness does not represent time
|_http-title: Intigriti SantaCloud CTF
| http-robots.txt: 8 disallowed entries 
| /package.json /backup.json /artisan /.env /.env.local 
|_/composer.json /composer.json* /composer.json~
```

This turns out to be a good catch, and, fortunately one of these entries (`/composer.json~`) is exposed:

```json
{
    "name": "intigriti-challenges/santacloud",
    "type": "project",
    "description": "SantaCloud - Supply Chain Portal",
    "version": "13.3.7",
    "keywords": ["laravel", "gifts", "christmas"],
    "license": "MIT",
    "config": {
        "admin-access": {
            "username": "elf_supervisor",
            "password": "CookiesAndMilk1337",
            "api-endpoint": "http://santacloud.intigriti.io/login",
        },
        "env": {
            "secret": "INTIGRITI{019b118e-e563-7348",
            "ttl": 3600
        }
    },
    "require": {
        "php": "^8.2",
        "laravel/framework": "^10.0",
        "firebase/php-jwt": "^6.10"
    },
    "authors": [
        {
            "name": "Elf Supervisor",
            "email": "devops@santacloud.intigriti.io"
        }
    ],
    "support": {
    }
}
```

The file leaks configuration and environment details, including **valid sign-in credentials**: 
    
    elf_supervisor:CookiesAndMilk1337

